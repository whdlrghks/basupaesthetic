<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="y">

  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="basup_ver2">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">

  <!-- Favicon -->
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link rel="icon" href="favicon.ico" type="image/x-icon">

  <title>BASUP</title>
  <link rel="manifest" href="manifest.json">

  <script>
    // The value below is injected by flutter build, do not touch.
    var serviceWorkerVersion = null;
  </script>
  <!-- This script adds the flutter initialization JS code -->
  <script src="flutter.js" defer></script>
<!--  <script type="module">-->

<!--    import * as firebase from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js";-->
<!--    import "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth-compat.js";-->
<!--    import "https://www.gstatic.com/firebasejs/10.0.0/firebase-storage-compat.js";-->

<!--    const firebaseConfig = {-->
<!--      apiKey: "AIzaSyCCr9Mi4quec3qX65S6T2CA-v-GroMKUeE",-->
<!--      authDomain: "basupaesthetic.firebaseapp.com",-->
<!--      databaseURL: "https://basupaesthetic-default-rtdb.firebaseio.com",-->
<!--      projectId: "basupaesthetic",-->
<!--      storageBucket: "basupaesthetic.appspot.com",-->
<!--      messagingSenderId: "709001858412",-->
<!--      appId: "1:709001858412:web:c0b0eb6d1c535e02a97749",-->
<!--      measurementId: "G-QDT4N8QZCX"-->
<!--    };-->

<!--    const app = firebase.initializeApp(firebaseConfig);-->
<!--    // compat API 사용: getAuth 대신 firebase.auth()를 사용합니다.-->
<!--    const auth = firebase.auth();-->
<!--    // Storage도 compat API 사용-->
<!--    const storage = firebase.storage();-->

<!--    globalThis.firebase = firebase;-->
<!--    globalThis.firebaseInitialized = true;-->
<!--    globalThis.firebaseauth = auth;-->


<!--    // 파일 업로드 함수 (수정됨)-->
<!--    globalThis.uploadFileToStorage = async function(path, file) {-->
<!--      try {-->
<!--        const storageRef = storage().ref(path);-->
<!--        const uploadTask = storageRef.put(file);-->
<!--        const snapshot = await uploadTask;-->
<!--        const downloadURL = await snapshot.ref.getDownloadURL();-->
<!--        return downloadURL;-->
<!--      } catch (error) {-->
<!--        console.error("Upload error:", error);-->
<!--        return null;-->
<!--      }-->
<!--    };-->

<!--  // 익명 로그인 함수를 정의 (compat API에 맞게)-->
<!--  async function signInAnonymouslyJS() {-->
<!--    try {-->
<!--      const result = await auth.signInAnonymously();-->
<!--      return result;-->
<!--    } catch (error) {-->
<!--      console.error("Anonymous sign-in error:", error);-->
<!--      return null;-->
<!--    }-->
<!--  }-->


<!--    globalThis.addEventListener('load', function(ev) {-->
<!--      _flutter.loader.loadEntrypoint({-->
<!--        serviceWorker: {-->
<!--          serviceWorkerVersion: serviceWorkerVersion,-->
<!--        }-->
<!--      }).then(function(engineInitializer) {-->
<!--        return engineInitializer.initializeEngine();-->
<!--      }).then(function(appRunner) {-->
<!--        return appRunner.runApp();-->
<!--      });-->
<!--    });-->

<!--    // 매우 중요한 부분: 전역에 노출합니다.-->
<!--    globalThis.signInAnonymouslyJS = signInAnonymouslyJS;-->
<!--    // 혹은 명시적으로 window 객체에 할당 (모듈 스크립트에서는 전역 노출이 자동되지 않음)-->
<!--    window.signInAnonymouslyJS = signInAnonymouslyJS;-->
<!--  </script>-->
</head>
<body>
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-storage-compat.js"></script>
<script >


    const firebaseConfig = {
      apiKey: "AIzaSyCCr9Mi4quec3qX65S6T2CA-v-GroMKUeE",
      authDomain: "basupaesthetic.firebaseapp.com",
      databaseURL: "https://basupaesthetic-default-rtdb.firebaseio.com",
      projectId: "basupaesthetic",
      storageBucket: "basupaesthetic.appspot.com",
      messagingSenderId: "709001858412",
      appId: "1:709001858412:web:c0b0eb6d1c535e02a97749",
      measurementId: "G-QDT4N8QZCX"
    };

    const app = firebase.initializeApp(firebaseConfig);
    // compat API 사용: getAuth 대신 firebase.auth()를 사용합니다.
    const auth = firebase.auth();
    // Storage도 compat API 사용
    const storage = firebase.storage();

    globalThis.firebase = firebase;
    globalThis.firebaseInitialized = true;
    globalThis.firebaseauth = auth;


    // 파일 업로드 함수 (수정됨)
    globalThis.uploadFileToStorage = async function(path, file) {
      try {
        const storageRef = storage().ref(path);
        const uploadTask = storageRef.put(file);
        const snapshot = await uploadTask;
        const downloadURL = await snapshot.ref.getDownloadURL();
        return downloadURL;
      } catch (error) {
        console.error("Upload error:", error);
        return Promise.reject(error);
      }
    };

  // 익명 로그인 함수를 정의 (compat API에 맞게)
  async function signInAnonymouslyJS() {
    try {
      const result = await auth.signInAnonymously();
      return result;
    } catch (error) {
      console.error("Anonymous sign-in error:", error);
        return Promise.reject(error);
    }
  }


    globalThis.addEventListener('load', function(ev) {
      _flutter.loader.loadEntrypoint({
        serviceWorker: {
          serviceWorkerVersion: serviceWorkerVersion,
        }
      }).then(function(engineInitializer) {
        return engineInitializer.initializeEngine();
      }).then(function(appRunner) {
        return appRunner.runApp();
      });
    });

    // 매우 중요한 부분: 전역에 노출합니다.
    globalThis.signInAnonymouslyJS = signInAnonymouslyJS;
    // 혹은 명시적으로 window 객체에 할당 (모듈 스크립트에서는 전역 노출이 자동되지 않음)
    window.signInAnonymouslyJS = signInAnonymouslyJS;
  </script>
<script>
  window.uploadFileToStorage = function(path, file, callback) {
    const storageRef = firebase.storage().ref(path);
    const uploadTask = storageRef.put(file);

    uploadTask.on('state_changed',
      (snapshot) => {
        // Optional: Handle progress
        // You can use snapshot.bytesTransferred and snapshot.totalBytes to show upload progress
      },
      (error) => {
        // Handle unsuccessful uploads
        console.error('Upload error:', error);
        callback(null, error); // Notify the Dart side of an error
      },
      () => {
        // Handle successful uploads on complete
        uploadTask.snapshot.ref.getDownloadURL().then(
          (downloadURL) => {
            callback(downloadURL, null); // First argument is the URL, second argument (error) is null
          },
          (error) => {
            // Handle any errors during the getDownloadURL() call
            console.error('Error getting download URL:', error);
            callback(null, error);
          }
        );
      }
    );
  }
</script>
</body>
</html>
